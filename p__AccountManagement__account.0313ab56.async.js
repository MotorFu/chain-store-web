(self.webpackChunkchain_store=self.webpackChunkchain_store||[]).push([[845],{70725:function(re,k,a){"use strict";a.d(k,{oM:function(){return h},Rk:function(){return q}});var h={pageSize:10},P;(function(c){c[c.SUPER_ADMIN=1]="SUPER_ADMIN",c[c.NORMAL_ADMIN=2]="NORMAL_ADMIN",c[c.STORE_ADMIN=3]="STORE_ADMIN"})(P||(P={}));var T;(function(c){c[c.SUPER_ADMIN=1]="SUPER_ADMIN",c[c.NORMAL_ADMIN=2]="NORMAL_ADMIN",c[c.CASHIER=3]="CASHIER"})(T||(T={}));var A;(function(c){c[c.CASH=1]="CASH",c[c.ALIPAY=2]="ALIPAY",c[c.WECHAT=3]="WECHAT"})(A||(A={}));var q=[{value:0,label:"\u4E0D\u9650"},{value:1,label:"\u73B0\u91D1"},{value:2,label:"\u652F\u4ED8\u5B9D"},{value:3,label:"\u5FAE\u4FE1"}]},53563:function(re,k,a){"use strict";a.r(k),a.d(k,{default:function(){return De}});var h=a(11849),P=a(57663),T=a(71577),A=a(3182),q=a(71194),c=a(57016),$e=a(49111),ae=a(19650),Be=a(59250),ue=a(13013),ke=a(30887),N=a(99210),we=a(71153),D=a(60331),w=a(2824),oe=a(94043),p=a.n(oe),$=a(67294),le=a(81907),se=a(85224),ie=a(33145),ce=a(8812),de=a(49101),B=a(21010);function fe(t,n,r,e){return U.apply(this,arguments)}function U(){return U=(0,A.Z)(p().mark(function t(n,r,e,u){return p().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,B.WY)("/api/account",(0,h.Z)({method:"GET",params:(0,h.Z)((0,h.Z)({},n),{},{sorter:r,filter:e})},u||{})));case 1:case"end":return m.stop()}},t)})),U.apply(this,arguments)}function ve(t){return L.apply(this,arguments)}function L(){return L=(0,A.Z)(p().mark(function t(n){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,B.WY)("/api/account",(0,h.Z)({method:"PUT"},n||{})));case 1:case"end":return e.stop()}},t)})),L.apply(this,arguments)}function pe(t,n){return z.apply(this,arguments)}function z(){return z=(0,A.Z)(p().mark(function t(n,r){return p().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,B.WY)("/api/account/enabled",(0,h.Z)({method:"PUT",data:n},r||{})));case 1:case"end":return u.stop()}},t)})),z.apply(this,arguments)}function he(t){return W.apply(this,arguments)}function W(){return W=(0,A.Z)(p().mark(function t(n){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,B.WY)("/api/account",(0,h.Z)({method:"POST"},n||{})));case 1:case"end":return e.stop()}},t)})),W.apply(this,arguments)}function _(t){return G.apply(this,arguments)}function G(){return G=(0,A.Z)(p().mark(function t(n){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,B.WY)("/api/account",(0,h.Z)({method:"DELETE"},n||{})));case 1:case"end":return e.stop()}},t)})),G.apply(this,arguments)}function Me(t,n,r){return Y.apply(this,arguments)}function Y(){return Y=_asyncToGenerator(_regeneratorRuntime.mark(function t(n,r,e){return _regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/account/".concat(r,"/store/relation"),_objectSpread({method:"GET",params:_objectSpread({},n)},e||{})));case 1:case"end":return l.stop()}},t)})),Y.apply(this,arguments)}function Oe(t){return H.apply(this,arguments)}function H(){return H=_asyncToGenerator(_regeneratorRuntime.mark(function t(n){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/account/store/relation",_objectSpread({method:"POST"},n||{})));case 1:case"end":return e.stop()}},t)})),H.apply(this,arguments)}function Pe(t){return V.apply(this,arguments)}function V(){return V=_asyncToGenerator(_regeneratorRuntime.mark(function t(n){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/account/store/relation",_objectSpread({method:"DELETE"},n||{})));case 1:case"end":return e.stop()}},t)})),V.apply(this,arguments)}var K=a(3843),M=a(5966),me=a(26743),J=a(64317),ge=a(86582),ye=a(27484),Q=a.n(ye),Ae=a(8575),ee=a(96486),X=a(15623);function Se(t,n,r){var e=t.body,u=e.id,l=e.enabled,m=r.filter(function(j){return j.id===u})[0];m.enabled=!l,n.send({status:"ok",success:!0})}function Ze(t,n,r){var e=t.body;console.log("mock update",e),e.forEach(function(u){var l=r.findIndex(function(m){return m.id===u.id});r.splice(l,1)}),n.send({status:"ok",success:!0})}function Fe(t,n,r,e){var u=t.body;console.log("mock create ",u);var l=[];r.forEach(function(m){l.push(m.id)}),u.id=Math.max.apply(Math,l)+1,u.key=String(u.id),u.enabled=!0,u.createdAt=Q()().valueOf(),r.push((0,h.Z)((0,h.Z)({},u),e)),n.send({status:"ok",success:!0})}function xe(t,n,r){var e=t.body;e.lastModifiedAt=Q()().valueOf(),console.log("mock update",e);var u=r.findIndex(function(l){return l.id===e.id});r[u]=e,n.send({status:"ok",success:!0})}var ne=["https://img2.fr-trading.com/0/2_592_67091_800_600.jpg.webp","https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRK8fMtwaPzUkLKdDdo8dtkMAT0pomCy8WBSg&usqp=CAU"],be=function(n,r){console.log("store init data");for(var e=[],u=0;u<r;u+=1){var l=(n-1)*10+u;e.push({id:l+1,key:"".concat(l+1),name:"".concat((0,X.mock)("@ctitle(3,7)")),image:ne[X.Random.natural(0,ne.length-1)],phone:"".concat(16688e6+u),address:(0,X.mock)("@county(true)"),enabled:u%4!=0,createdAt:Q()().add(-(r-u),"day").valueOf()})}return e.reverse(),e},C=be(1,15);function je(){var t=[];return C.forEach(function(n){t.push(n)}),t}function Re(t,n,r){var e=je(),u=r;(!u||Object.prototype.toString.call(u)!=="[object String]")&&(u=t.url);var l=t.query,m=l.current,j=m===void 0?1:m,y=l.pageSize,S=y===void 0?10:y,s=(0,Ae.Qc)(u,!0).query;if(s.sorter){var R=JSON.parse(s.sorter);e=e.sort(function(d,g){var E=0;return Object.keys(R).forEach(function(f){if(R[f]==="descend"){d[f]-g[f]>0?E+=-1:E+=1;return}d[f]-g[f]>0?E+=1:E+=-1}),E})}console.log("params----->",s),s.id&&(e=e.filter(function(d){return(d==null?void 0:d.id)===(0,ee.parseInt)("".concat(s.id),10)})),s.name&&(e=e.filter(function(d){var g;return d==null||(g=d.name)===null||g===void 0?void 0:g.includes(s.name||"")})),s.phone&&(e=e.filter(function(d){var g;return d==null||(g=d.phone)===null||g===void 0?void 0:g.includes(s.phone||"")})),s.address&&(e=e.filter(function(d){var g;return d==null||(g=d.address)===null||g===void 0?void 0:g.includes(s.address||"")})),s.enabled&&(String(s.enabled)==="true"||String(s.enabled)==="false")&&(e=e.filter(function(d){return(d!=null&&d.enabled?"true":"false")===String(s.enabled)}));var O=(0,ge.Z)(e).slice((j-1)*S,j*S),I={data:O,total:e.length,success:!0,pageSize:S,current:(0,ee.parseInt)("".concat(s.current),10)||1};return n.json(I)}var Ne={"GET /api/store":Re,"POST /api/store":function(n,r){return Fe(n,r,C)},"PUT /api/store":function(n,r){return xe(n,r,C)},"PUT /api/store/enabled":function(n,r){return Se(n,r,C)},"DELETE /api/store":function(n,r){return Ze(n,r,C)}},o=a(85893),te={labelCol:{span:4},wrapperCol:{span:16}},Ee=function(n){var r,e,u=(0,$.useState)(!1),l=(0,w.Z)(u,2),m=l[0],j=l[1];return(0,o.jsxs)(K.Z,{stepsProps:{size:"small"},stepsFormRender:function(S,s){return(0,o.jsx)(c.Z,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:n.values.id==null?"\u6DFB\u52A0\u8D26\u53F7":"\u4FEE\u6539\u8D26\u53F7",visible:n.visible,footer:s,onCancel:function(){n.onCancel()},children:S})},onFinish:n.onSubmit,children:[(0,o.jsxs)(K.Z.StepForm,(0,h.Z)((0,h.Z)({layout:"horizontal"},te),{},{initialValues:{id:n.values.id,username:n.values.username,phone:n.values.phone,icon:n.values.icon?[{thumbUrl:n.values.icon}]:null},title:"\u57FA\u672C\u4FE1\u606F",children:[(0,o.jsx)(M.Z,{name:"id",width:"md",label:"\u624B\u673A\u53F7",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",hidden:!0}),(0,o.jsx)(me.Z,{name:"icon",label:"\u5934\u50CF",max:1,fieldProps:{name:"file",listType:"picture-card"},transform:function(S){return{icon:S[0].thumbUrl}},action:"/upload.do",rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u56FE\u7247\uFF01"}]}),(0,o.jsx)(M.Z,{name:"username",label:"\u8D26\u53F7",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D26\u53F7\uFF01"}]}),(0,o.jsx)(M.Z,{name:"phone",width:"md",label:"\u624B\u673A\u53F7",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",rules:[{required:!0,message:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^1\d{10}$/,message:"\u4E0D\u5408\u6CD5\u7684\u624B\u673A\u53F7\u683C\u5F0F!"}]})]})),(0,o.jsxs)(K.Z.StepForm,(0,h.Z)((0,h.Z)({layout:"horizontal"},te),{},{initialValues:{id:n.values.id,type:n.values.type,storeRelation:{role:(r=n.values.storeRelation)===null||r===void 0?void 0:r.role,storeId:(e=n.values.storeRelation)===null||e===void 0?void 0:e.storeId}},title:"\u8D26\u53F7\u7C7B\u578B",onValuesChange:function(S,s){console.log("onValuesChange---->",S,s),j(s.type===3)},children:[(0,o.jsx)(M.Z,{name:"id",width:"md",label:"\u624B\u673A\u53F7",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",hidden:!0}),(0,o.jsx)(J.Z,{name:"type",label:"\u8D26\u53F7\u7C7B\u578B",options:[{value:2,label:"\u7CFB\u7EDF\u7BA1\u7406\u5458"},{value:3,label:"\u95E8\u5E97\u7BA1\u7406\u5458"}]}),n.values.type===3||m?[(0,o.jsx)(J.Z,{name:["storeRelation","role"],label:"\u95E8\u5E97\u89D2\u8272",options:[{value:1,label:"\u8D85\u7EA7\u7BA1\u7406\u5458"},{value:2,label:"\u666E\u901A\u7BA1\u7406\u5458"},{value:3,label:"\u6536\u94F6\u5458"}]},"storeRelation.role"),(0,o.jsx)(J.Z,{name:["storeRelation","storeId"],label:"\u95E8\u5E97",request:(0,A.Z)(p().mark(function y(){return p().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",C.map(function(R){return{value:R.id,label:R.name}}));case 1:case"end":return s.stop()}},y)}))},"storeRelation.storeId")]:null]}))]})},Ce=Ee,Ie=a(70725),Te=function(){var n=(0,$.useState)(!1),r=(0,w.Z)(n,2),e=r[0],u=r[1],l=(0,$.useRef)(),m=(0,$.useState)([]),j=(0,w.Z)(m,2),y=j[0],S=j[1],s=(0,$.useState)(),R=(0,w.Z)(s,2),O=R[0],I=R[1],d=[{title:"\u8D26\u53F7ID",key:"id",dataIndex:"id",sorter:!0},{title:"\u5934\u50CF",key:"icon",dataIndex:"icon",valueType:"avatar"},{title:"\u8D26\u53F7",key:"username",dataIndex:"username"},{title:"\u624B\u673A\u53F7",key:"phone",dataIndex:"phone"},{title:"\u8D26\u53F7\u7C7B\u578B",key:"type",dataIndex:"type",valueEnum:{0:{text:"\u4E0D\u9650",status:""},1:{text:"\u8D85\u7EA7\u7BA1\u7406\u5458",status:""},2:{text:"\u7CFB\u7EDF\u7BA1\u7406\u5458",status:""},3:{text:"\u95E8\u5E97\u7BA1\u7406\u5458",status:""}},render:function(v,i){return i.type===1?(0,o.jsx)(D.Z,{color:"#108ee9",children:"\u8D85\u7EA7\u7BA1\u7406\u5458"},i.key):i.type===2?(0,o.jsx)(D.Z,{color:"cyan",children:"\u7CFB\u7EDF\u7BA1\u7406\u5458"},i.key):(0,o.jsx)(D.Z,{color:"purple",children:"\u95E8\u5E97\u7BA1\u7406\u5458"},i.key)}},{title:"\u8D26\u53F7\u72B6\u6001",key:"enabled",dataIndex:"enabled",valueType:"select",initialValue:"0",valueEnum:{0:{text:"\u4E0D\u9650",status:""},true:{text:"\u5DF2\u542F\u7528",checked:!0,status:""},false:{text:"\u5DF2\u7981\u7528",checked:!1,status:""}},render:function(v,i){return i.enabled?(0,o.jsx)(D.Z,{color:"success",children:"\u5DF2\u542F\u7528"}):(0,o.jsx)(D.Z,{color:"error",children:"\u5DF2\u7981\u7528"})}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"createdAt",dataIndex:"createdAt",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",valueType:"dateRange",hideInTable:!0,search:{transform:function(v){return{startTime:v[0],endTime:v[1]}}}},{title:"\u64CD\u4F5C",key:"option",dataIndex:"option",hideInSearch:!0,width:160,render:function(v,i){return(0,o.jsxs)(ae.Z,{size:"middle",children:[(0,o.jsx)("a",{onClick:function(){I(i),u(!0)},children:"\u7F16\u8F91"},"edit"),(0,o.jsx)("a",{onClick:function(){return g(i)},children:i.enabled?"\u7981\u7528":"\u542F\u7528"},"enabled"),(0,o.jsx)(ue.Z,{trigger:["click"],overlay:(0,o.jsxs)(N.Z,{children:[(0,o.jsx)(N.Z.Item,{children:"\u4FEE\u6539\u5BC6\u7801"},0),i.type===1?null:(0,o.jsx)(N.Z.Item,{onClick:function(){return E(i)},children:"\u5220\u9664\u8D26\u53F7"},1)]}),children:(0,o.jsxs)("a",{children:["\u66F4\u591A",(0,o.jsx)(ce.Z,{})]})},"more")]})}}];function g(f){c.Z.confirm({title:"\u63D0\u793A",content:(0,o.jsxs)("div",{children:["\u786E\u5B9A\u8981",f.enabled?"\u7981\u7528":"\u5F00\u542F","\u8D26\u53F7\uFF1F"]}),onOk:function(){var v=(0,A.Z)(p().mark(function Z(){var F;return p().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,pe(f);case 2:F=b.sent,F&&l.current&&l.current.reload();case 4:case"end":return b.stop()}},Z)}));function i(){return v.apply(this,arguments)}return i}()})}function E(f){c.Z.confirm({title:"\u63D0\u793A",content:(0,o.jsxs)("div",{children:["\u786E\u5B9A\u8981\u5220\u9664\u3010",f.username,"\u3011\u8D26\u53F7\uFF1F"]}),onOk:function(){var v=(0,A.Z)(p().mark(function Z(){var F;return p().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,_({data:[f]});case 2:F=b.sent,F&&l.current&&l.current.reload();case 4:case"end":return b.stop()}},Z)}));function i(){return v.apply(this,arguments)}return i}()})}return(0,o.jsxs)(le.ZP,{children:[(0,o.jsx)(ie.ZP,{pagination:Ie.oM,headerTitle:"headerTitle",actionRef:l,rowKey:"key",search:{labelWidth:120},toolBarRender:function(){return[(0,o.jsxs)(T.Z,{type:"primary",onClick:function(){e||(u(!0),I(void 0))},children:[(0,o.jsx)(de.Z,{})," \u6DFB\u52A0"]},"primary")]},request:fe,columns:d,rowSelection:{onChange:function(v,i){S(i)}}}),(y==null?void 0:y.length)>0&&(0,o.jsx)(se.Z,{extra:(0,o.jsx)("div",{children:(0,o.jsxs)("span",{children:["\u5DF2\u9009\u4E2D",y.reduce(function(f,v){return f+v.id},0)," \u4E2A\u8D26\u53F7"]})}),children:(0,o.jsx)(T.Z,{onClick:(0,A.Z)(p().mark(function f(){var v,i;return p().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return console.log("selectedRowsState--->",y),F.next=3,_({data:y});case 3:S([]),(v=l.current)===null||v===void 0||(i=v.reloadAndRest)===null||i===void 0||i.call(v);case 5:case"end":return F.stop()}},f)})),children:"\u6279\u91CF\u5220\u9664"})}),(0,o.jsx)(Ce,{onSubmit:function(){var f=(0,A.Z)(p().mark(function v(i){var Z;return p().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(console.log("edit item values--->",i),!i.id){x.next=7;break}return x.next=4,ve({data:(0,h.Z)((0,h.Z)({},O),i)});case 4:Z=x.sent,x.next=10;break;case 7:return x.next=9,he({data:i});case 9:Z=x.sent;case 10:Z&&(u(!1),I(void 0),l.current&&l.current.reload());case 11:case"end":return x.stop()}},v)}));return function(v){return f.apply(this,arguments)}}(),onCancel:function(){u(!1),I(void 0)},visible:e,values:O||{}})]})},De=Te}}]);
